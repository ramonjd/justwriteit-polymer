<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-input/core-input.html">
<polymer-element name="count-down" attributes="duration">
  <template>
    <link rel="stylesheet" href="count-down.css">
    <paper-input id="countDownElement" readonly="true" value="00:00:00"></paper-input>
  </template>
  <script>
    (function () {
      'use strict';
      /*

      1 min : 60
      30 min : 1800
      1 hour : 3600
      
      */
      var end,
      s = 1000,
      m = s * 60,
      h = m * 60,
      d = h * 24,
      timer,
      countdownArray,
      divider = ':',
      now,
      distance,
      renderedDate;


      Polymer('count-down', {

        // default duration = 30 mins (1800 secs)
        duration : 1800,

        ready: function() {
          end = new Date();
          // add selected seconds to current time
          end.setSeconds(end.getSeconds() + this.duration);
          return this;
        },

        start : function(){
          timer = setInterval(this.render.bind(this), 1000);  
          return this;
        },
        
        render : function(){
            now = new Date();
            distance = end.getTime()-now.getTime();

            if (distance < 0) {
                this.stop();
                this.fire('complete');
                return false;
            }

            // key
            // day =  Math.floor(distance / d);
            // hour = Math.floor((distance % d) / h);
            // min = Math.floor((distance % h) / m);
            // sec = Math.floor((distance % m) / s);

            countdownArray = [];
            countdownArray.push(JFWI.pad(Math.floor((distance % d) / h)));
            countdownArray.push(JFWI.pad(Math.floor((distance % h) / m)));
            countdownArray.push(JFWI.pad(Math.floor((distance % m) / s)));

            renderedDate = countdownArray.join(divider);

            this.$.countDownElement.value = renderedDate;

            this.fire('tick', {value: renderedDate, percentage: JFWI.getCompletedTimePercentage(distance, this.duration)});

            return this;
        },
        
        pause : function(){

        },
        
        stop : function(){
          clearInterval(timer);   
          return this;
        }
      });

    })();
  </script>
</polymer-element>
